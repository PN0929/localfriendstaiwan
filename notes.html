<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trail Notes æ¢è·¯ç­†è¨˜ - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š</title>
  <meta name="description" content="Trail Notes æ¢è·¯ç­†è¨˜ï¼šå¯¦åœ°èµ°è¨ªç´€éŒ„ã€å¹•å¾Œæ•…äº‹ã€æ—…äººè§€å¿µæ–‡èˆ‡æœ€æ–°åˆä½œæ›´æ–°ï¼Œå¸¶ä½ çœ‹è¦‹çœŸå¯¦å°ç£çš„åœ¨åœ°ç¶²çµ¡ã€‚">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --header-height: 56px;
      --max-width: 1100px;
      --green: #2D6A4F;
      --bg: #F7F5F2;
      --accent: #F4845F;
      --accent-soft: #E9C46A;
      --note-tag: #40916C;
    }

    html, body { overflow-x: hidden; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
      line-height: 1.7;
      color: var(--green);
      background: var(--bg);
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      word-break: keep-all;
      overflow-wrap: anywhere;
    }
    h1, h2, h3 { text-wrap: balance; }
    img, video { max-width: 100%; height: auto; display: block; }

    /* ===== å…±ç”¨ Header ===== */
    .site-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header-height);
      padding: 0 1.5rem;
      display: flex;
      align-items: center;
      gap: 1.25rem;
      background: rgba(247, 245, 242, 0.98);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(45, 106, 79, 0.06);
      z-index: 1100;
    }
    .brand {
      display: flex;
      flex-direction: column;
      justify-content: center;
      line-height: 1.2;
    }
    .brand a {
      text-decoration: none;
      color: var(--green);
    }
    .brand-en {
      font-weight: 700;
      letter-spacing: 0.11em;
      font-size: 0.78rem;
    }
    .brand-zh {
      opacity: 0.9;
      font-size: 0.78rem;
    }

    .main-nav {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .main-nav a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      border: 1.4px solid transparent;
      font-size: 0.86rem;
      font-weight: 700;
      color: var(--green);
      text-decoration: none;
      white-space: nowrap;
      transition: all 0.18s;
    }
    .main-nav a span.en { margin-right: 0.18rem; }
    .main-nav a:hover,
    .main-nav a.active {
      border-color: var(--accent-soft);
      background: #FFF7EB;
      box-shadow: 0 2px 8px rgba(233,196,106,.25);
      transform: translateY(-1px);
    }

    .nav-toggle {
      display: none;
      margin-left: auto;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1.4px solid var(--green);
      background: transparent;
      color: var(--green);
      font-size: 1.2rem;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .nav-toggle:hover { background: #E9C46A22; }
    .nav-toggle.open {
      background: var(--green);
      color: #F7F5F2;
      border-color: var(--green);
    }

    @media (max-width: 768px) {
      .site-header { padding: 0 1rem; }
      .brand-en,
      .brand-zh { font-size: 0.74rem; }

      .main-nav {
        position: fixed;
        top: var(--header-height);
        left: 0; right: 0;
        padding: 0.45rem 0.85rem 0.55rem;
        background: rgba(247,245,242,0.98);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(45,106,79,0.08);
        display: none;
        flex-wrap: nowrap;
        gap: 0.45rem;
        overflow-x: auto;
        white-space: nowrap;
        z-index: 1090;
      }
      .main-nav.open { display: flex; }
      .main-nav::-webkit-scrollbar { height: 3px; }
      .main-nav::-webkit-scrollbar-thumb {
        background: rgba(233,196,106,0.9);
        border-radius: 999px;
      }
      .main-nav a {
        padding: 0.35rem 0.8rem;
        font-size: 0.8rem;
        box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      }

      .nav-toggle { display: inline-flex; }
    }

    /* å›é ‚æŒ‰éˆ• */
    .back-to-top {
      position: fixed;
      right: 30px;
      bottom: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #F4845F, #F4A261);
      color: #fff;
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(244,132,95,0.4);
      display: none;
      z-index: 1000;
      transition: transform 0.3s;
    }
    .back-to-top:hover { transform: translateY(-5px); }
    .back-to-top.show {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeInUp 0.5s ease;
    }

    /* Hero */
    .hero {
      padding: calc(var(--header-height) + 2.6rem) 1.5rem 2.2rem;
      background: linear-gradient(
        135deg,
        rgba(45,106,79,0.98),
        rgba(64,145,108,0.96)
      );
      color: #fff;
    }
    .hero-inner {
      max-width: var(--max-width);
      margin: 0 auto;
    }
    .hero-kicker {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      opacity: 0.9;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }
    .hero-title {
      font-size: 2.1rem;
      font-weight: 800;
      margin-bottom: 0.35rem;
    }
    .hero-sub {
      font-size: 0.97rem;
      opacity: 0.97;
      max-width: 760px;
    }

    /* Page wrapper */
    .page {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 2rem 1.5rem 3rem;
    }

    /* Intro block */
    .intro {
      margin-bottom: 1.8rem;
      font-size: 0.93rem;
      color: #445;
    }
    .intro p {
      margin-bottom: 0.35rem;
    }
    .intro strong { color: var(--green); }

    /* Filter row */
    .filter-bar {
      margin-bottom: 1.2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: center;
    }
    .filter-label {
      font-size: 0.8rem;
      color: #667;
      margin-right: 0.2rem;
    }
    .filter-pill {
      padding: 0.25rem 0.8rem;
      border-radius: 999px;
      font-size: 0.78rem;
      border: 1px solid #E0D8C7;
      background: #fff;
      color: #556;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .filter-pill.active {
      background: #FFF7EB;
      color: #2D6A4F;
      border-color: var(--accent);
      box-shadow: 0 2px 8px rgba(244,132,95,0.28);
    }
    .filter-pill:hover {
      border-color: #E9C46A;
      background: #FFFAF2;
    }

    /* Notes grid */
    .notes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.1rem;
    }
    .note-card {
      position: relative;
      background: #fff;
      border-radius: 14px;
      padding: 0.9rem 0.9rem 0.95rem;
      border: 1px solid #E5DECF;
      box-shadow: 0 4px 10px rgba(0,0,0,0.03);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      transition: all 0.22s;
      cursor: pointer;
    }
    .note-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
      border-color: var(--accent-soft);
    }
    .note-cover {
      width: 100%;
      height: 140px;
      margin-bottom: 0.45rem;
      border-radius: 10px;
      overflow: hidden;
      background: #E9C46A22;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.78rem;
      color: #8a7;
    }
    .note-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .note-tag {
      display: inline-flex;
      align-items: center;
      padding: 0.14rem 0.55rem;
      border-radius: 999px;
      font-size: 0.7rem;
      background: #E9F5EE;
      color: var(--note-tag);
      margin-right: 0.25rem;
    }
    .note-type {
      display: inline-flex;
      padding: 0.14rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
      background: #FFF3E6;
      color: #C96A30;
    }
    .note-title {
      font-size: 0.98rem;
      font-weight: 800;
      color: var(--green);
      line-height: 1.45;
    }
    .note-subtitle {
      font-size: 0.78rem;
      color: #6a7b71;
    }
    .note-meta {
      font-size: 0.7rem;
      color: #9aa19a;
      display: flex;
      justify-content: space-between;
      gap: 0.3rem;
    }
    .note-summary {
      font-size: 0.8rem;
      color: #4f5d55;
      margin-top: 0.1rem;
      flex-grow: 1;
    }
    .note-link {
      margin-top: 0.4rem;
      font-size: 0.78rem;
      color: var(--accent);
      font-weight: 700;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
    }
    .note-link:hover {
      text-decoration: underline;
    }

    .empty-state {
      text-align: center;
      font-size: 0.86rem;
      color: #7c857b;
      padding: 1.8rem 0.5rem 0;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .footer {
      background: linear-gradient(135deg,#2D6A4F,#40916C);
      color: #fff;
      text-align: center;
      padding: 2.4rem 2rem;
    }
    .footer a {
      color: #fff;
      text-decoration: none;
      font-weight: 700;
    }
    .footer a:hover { text-decoration: underline; }

    @media (max-width: 768px) {
      .hero {
        padding: calc(var(--header-height) + 1.8rem) 1rem 1.6rem;
      }
      .hero-title {
        font-size: 1.7rem;
      }
      .hero-sub {
        font-size: 0.9rem;
      }
      .page {
        padding: 1.6rem 1rem 2.4rem;
      }
      .filter-bar {
        gap: 0.3rem;
      }
      .filter-pill {
        padding: 0.22rem 0.7rem;
        font-size: 0.76rem;
      }
      .notes-grid {
        grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
        gap: 0.9rem;
      }
      .note-card {
        padding: 0.78rem 0.78rem 0.85rem;
      }
      .note-cover {
        height: 120px;
      }

      .back-to-top {
        right: 16px;
        bottom: 16px;
        width: 48px;
        height: 48px;
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="brand">
      <a href="index.html">
        <div class="brand-en">LOCAL FRIENDS TAIWAN</div>
        <div class="brand-zh">å°ç£åœ¨åœ°é€£ç·š</div>
      </a>
    </div>
    <nav class="main-nav" id="mainNav">
      <a href="experiences.html"><span class="en">Experiences</span><span class="zh">é«”é©—åˆ—è¡¨</span></a>
      <a href="about.html"><span class="en">About</span><span class="zh">é—œæ–¼æˆ‘å€‘</span></a>
      <a href="faq.html"><span class="en">FAQ</span><span class="zh">å¸¸è¦‹å•é¡Œ</span></a>
      <a href="hosts.html"><span class="en">For Hosts</span><span class="zh">æˆç‚ºåœ¨åœ°æœ‹å‹</span></a>
      <a href="notes.html" class="active"><span class="en">Trail Notes</span><span class="zh">æ¢è·¯ç­†è¨˜</span></a>
      <a href="contact.html"><span class="en">Contact</span><span class="zh">è¯ç¹«æˆ‘å€‘</span></a>
    </nav>
    <button class="nav-toggle" id="navToggle" aria-label="åˆ‡æ›å°è¦½é¸å–®">â˜°</button>
  </header>

  <!-- Back to top -->
  <button class="back-to-top" onclick="scrollToTop()">â†‘</button>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-kicker">TRAIL NOTES Â· æ¢è·¯ç­†è¨˜</div>
      <h1 class="hero-title">Field notes from real Taiwan, one visit at a time</h1>
      <p class="hero-sub">
        å¯¦åœ°èµ°è¨ªã€èˆ‡åœ¨åœ°äººé•·è«‡å¾Œç•™ä¸‹çš„ç´€éŒ„ï¼š<strong>æ¢è¨ªç´€éŒ„</strong>ã€<strong>å¹•å¾Œæ•…äº‹</strong>ã€
        <strong>æ—…äººè§€å¿µæ–‡</strong>ã€<strong>æœ€æ–°æ›´æ–°</strong>ã€‚é€™è£¡ä¸æ˜¯è¯éº—è¡ŒéŠ·ç¨¿ï¼Œè€Œæ˜¯æˆ‘å€‘èµ°é€²ç¤¾å€ã€
        å·¥åŠèˆ‡å‹å–„ç©ºé–“å¾Œï¼Œé¡˜æ„èª å¯¦åˆ†äº«çš„è§€å¯Ÿèˆ‡å°è©±ã€‚
      </p>
    </div>
  </section>

  <!-- Content -->
  <main class="page">
    <!-- Intro -->
    <section class="intro">
      <p>
        Trail Notes æ˜¯ Local Friends Taiwan çš„ã€Œå¯¦åœ°ç­†è¨˜æœ¬ã€ï¼š
        æ¯ä¸€ç¯‡éƒ½æ˜¯æˆ‘å€‘è¦ªè‡ªæ‹œè¨ªã€å°è©±ã€æ…¢æ…¢å»ºç«‹ä¿¡ä»»å¾Œï¼Œç•™ä¸‹çš„ç´€éŒ„èˆ‡æ€è€ƒã€‚
      </p>
      <p>
        ä½ æœƒåœ¨é€™è£¡çœ‹åˆ°ï¼š
        <strong>æ¢è¨ªç´€éŒ„</strong>ï¼ˆæŸå€‹ç¤¾å€ã€çµ„ç¹”ã€ç©ºé–“çš„æ·±åº¦ä»‹ç´¹ï¼‰ã€
        <strong>Behind the Hosts</strong>ï¼ˆå’Œåœ¨åœ°æœ‹å‹å¦‚ä½•ç›¸é‡ï¼‰ã€
        <strong>Travel Mindset</strong>ï¼ˆå¦‚ä½•æˆç‚ºæ›´æº«æŸ”çš„æ—…äººï¼‰ã€
        ä»¥åŠ <strong>Updates</strong>ï¼ˆæ–°ä¸Šæ¶é«”é©—èˆ‡åˆä½œæ¶ˆæ¯ï¼‰ã€‚
      </p>
    </section>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <div class="filter-label">Filter é¡å‹ï¼š</div>
      <button class="filter-pill active" data-filter="all">All å…¨éƒ¨</button>
      <button class="filter-pill" data-filter="field">Field Notes æ¢è¨ªç´€éŒ„</button>
      <button class="filter-pill" data-filter="behind">Behind the Hosts å¹•å¾Œæ•…äº‹</button>
      <button class="filter-pill" data-filter="mindset">Travel Mindset æ—…äººè§€å¿µ</button>
      <button class="filter-pill" data-filter="updates">News / Updates æœ€æ–°æ¶ˆæ¯</button>
    </div>

    <!-- Notes grid -->
    <section id="notesGrid" class="notes-grid">
      <!-- åˆå§‹ loading skeletonï¼ˆè¼‰å…¥å¾Œæœƒè¢«æ›¿æ›ï¼‰ -->
      <div class="note-card">
        <div class="note-cover">Loading Trail Notes...</div>
        <div>
          <span class="note-tag">Loading</span>
        </div>
        <div class="note-title">Please wait while we fetch the latest field notes.</div>
        <p class="note-summary">æ­£åœ¨è¼‰å…¥æ¢è·¯ç­†è¨˜èˆ‡å¯¦åœ°èµ°è¨ªç´€éŒ„...</p>
      </div>
    </section>

    <!-- ç©ºç‹€æ…‹ï¼ˆé€é JS æ§åˆ¶é¡¯ç¤ºï¼‰ -->
    <div id="emptyState" class="empty-state" style="display:none;">
      å°šæœªæœ‰ç¬¦åˆç¯©é¸æ¢ä»¶çš„æ¢è·¯ç­†è¨˜ã€‚<br>
      Try another filter, or check back soon for new field notes.
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p style="font-size:1.2rem;margin-bottom:0.6rem;"><strong>Local Friends Taiwan å°ç£åœ¨åœ°é€£ç·š</strong></p>
    <p>Your local friend in Taiwan | ç•¶ä½ éœ€è¦ä¸€ä½å°ç£åœ¨åœ°çš„æœ‹å‹</p>
    <p style="margin-top:0.8rem;">
    </p>
    <p style="margin-top:1.2rem;opacity:0.9;font-size:0.95rem;">
      Â© 2025 Local Friends Taiwan. Independent Information Platform.
    </p>
  </footer>

  <script>
    // ===== Mobile nav toggle =====
    document.addEventListener('DOMContentLoaded', () => {
      const navToggle = document.getElementById('navToggle');
      const mainNav = document.getElementById('mainNav');
      if (navToggle && mainNav) {
        navToggle.addEventListener('click', () => {
          const isOpen = mainNav.classList.toggle('open');
          navToggle.classList.toggle('open', isOpen);
        });
        mainNav.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            if (mainNav.classList.contains('open')) {
              mainNav.classList.remove('open');
              navToggle.classList.remove('open');
            }
          });
        });
      }
    });

    // ===== Back to top =====
    window.addEventListener('scroll', () => {
      const b = document.querySelector('.back-to-top');
      if (!b) return;
      if (window.pageYOffset > 300) b.classList.add('show');
      else b.classList.remove('show');
    });
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ===== Trail Notes from Google Sheet =====
    // è«‹å°‡ SHEET_ID æ›¿æ›æˆä½ å¯¦éš›çš„ã€Œæ¢è·¯ç­†è¨˜ã€è©¦ç®—è¡¨ ID
    const SHEET_ID = 'YOUR_TRAIL_NOTES_SHEET_ID_HERE';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

    document.addEventListener('DOMContentLoaded', () => {
      loadTrailNotes();
      setupFilters();
    });

    async function loadTrailNotes() {
      const grid = document.getElementById('notesGrid');
      const emptyState = document.getElementById('emptyState');

      if (!SHEET_ID || SHEET_ID === 'YOUR_TRAIL_NOTES_SHEET_ID_HERE') {
        // è‹¥å°šæœªè¨­å®š Sheetï¼Œåƒ…é¡¯ç¤ºéœæ…‹æç¤º
        grid.innerHTML = `
          <div class="note-card">
            <div class="note-cover">Trail Notes setup</div>
            <div><span class="note-tag">Setup</span></div>
            <div class="note-title">Connect your Trail Notes sheet</div>
            <p class="note-summary">
              è«‹åœ¨ notes.html ä¸­è¨­å®šæ­£ç¢ºçš„ SHEET_IDï¼Œè®“é€™è£¡è‡ªå‹•é¡¯ç¤ºæ¢è·¯ç­†è¨˜å¡ç‰‡ã€‚
            </p>
          </div>`;
        emptyState.style.display = 'none';
        return;
      }

      try {
        const resp = await fetch(SHEET_URL);
        const text = await resp.text();
        const rows = parseCSV(text);
        if (!rows || rows.length <= 1) {
          grid.innerHTML = '';
          emptyState.style.display = 'block';
          return;
        }

        const headers = rows[0];
        const data = rows.slice(1)
          .map(r => {
            const o = {};
            headers.forEach((h, i) => o[h.trim()] = (r[i] || '').trim());
            return o;
          })
          .filter(o => o['Title EN'] || o['Title ZH'] || o['æ¨™é¡Œ']);

        const cards = data.map(buildNoteCardHTML).join('');
        grid.innerHTML = cards || '';
        applyFilter(getCurrentFilter());
      } catch (err) {
        console.error('Error loading Trail Notes:', err);
        grid.innerHTML = `
          <div class="note-card">
            <div class="note-cover">Error</div>
            <div><span class="note-tag">Error</span></div>
            <div class="note-title">ç„¡æ³•è¼‰å…¥æ¢è·¯ç­†è¨˜</div>
            <p class="note-summary">è«‹ç¨å¾Œé‡æ–°æ•´ç†é é¢ï¼Œæˆ–æª¢æŸ¥è©¦ç®—è¡¨åˆ†äº«æ¬Šé™è¨­å®šã€‚</p>
          </div>`;
        emptyState.style.display = 'none';
      }
    }

    function parseCSV(csv) {
      const lines = csv.split('\n').filter(l => l.trim() !== '');
      return lines.map(line => {
        const values = [];
        let cur = '';
        let inQ = false;
        for (let i = 0; i < line.length; i++) {
          const ch = line[i];
          if (ch === '"') {
            if (inQ && line[i+1] === '"') {
              cur += '"';
              i++;
            } else {
              inQ = !inQ;
            }
          } else if (ch === ',' && !inQ) {
            values.push(cur);
            cur = '';
          } else {
            cur += ch;
          }
        }
        values.push(cur);
        return values.map(v => v.trim());
      });
    }

    function buildNoteCardHTML(o) {
      // é æœŸæ¬„ä½ï¼ˆå¯ä¾ä½ çš„ Sheet å‘½åå°æ‡‰ï¼‰ï¼š
      // Category: Field / Behind / Mindset / Updates
      // Type: optional sub-label
      // Title EN, Title ZH
      // Summary
      // Cover: image url
      // Link: Google Doc / note-detail.html?id=...
      // Date: YYYY-MM-DD
      const categoryRaw = (o['Category'] || o['é¡åˆ¥'] || '').toLowerCase();
      let categoryKey = 'field';
      if (categoryRaw.includes('behind')) categoryKey = 'behind';
      else if (categoryRaw.includes('mindset') || categoryRaw.includes('è§€å¿µ')) categoryKey = 'mindset';
      else if (categoryRaw.includes('update') || categoryRaw.includes('news')) categoryKey = 'updates';

      const categoryLabel =
        categoryKey === 'field' ? 'Field Notes æ¢è¨ªç´€éŒ„' :
        categoryKey === 'behind' ? 'Behind the Hosts å¹•å¾Œæ•…äº‹' :
        categoryKey === 'mindset' ? 'Travel Mindset æ—…äººè§€å¿µ' :
        'News / Updates æœ€æ–°æ¶ˆæ¯';

      const typeLabel = o['Type'] || o['æ¨™ç±¤'] || '';
      const titleEn = o['Title EN'] || o['æ¨™é¡ŒEN'] || '';
      const titleZh = o['Title ZH'] || o['æ¨™é¡Œ'] || '';
      const summary = o['Summary'] || o['æ‘˜è¦'] || '';
      const cover = o['Cover'] || o['å°é¢'] || '';
      const link = o['Link'] || o['é€£çµ'] || '';
      const date = o['Date'] || o['æ—¥æœŸ'] || '';
      const place = o['Place'] || o['åœ°é»'] || '';

      const safeLink = link ? link : '';
      const linkLabel = link && link.indexOf('docs.google.com') !== -1
        ? 'Read full note on Google Docs'
        : 'Read full story';

      return `
        <article class="note-card" data-category="${categoryKey}">
          ${cover ? `
            <div class="note-cover">
              <img src="${cover}" alt="${escapeHtml(titleEn || titleZh || 'Trail Note')}"
                   loading="lazy"
                   onerror="this.parentElement.textContent='Image not available';">
            </div>` : `
            <div class="note-cover">
              Trail Notes Â· ${categoryLabel}
            </div>`}
          <div>
            <span class="note-tag">${categoryLabel}</span>
            ${typeLabel ? `<span class="note-type">${escapeHtml(typeLabel)}</span>` : ``}
          </div>
          <div class="note-title">
            ${escapeHtml(titleEn || '')}
            ${titleZh ? `<span class="note-subtitle">ï½œ${escapeHtml(titleZh)}</span>` : ``}
          </div>
          ${summary ? `<p class="note-summary">${escapeHtml(summary)}</p>` : ``}
          <div class="note-meta">
            <span>${place ? `ğŸ“ ${escapeHtml(place)}` : ''}</span>
            <span>${date ? `ğŸ—“ ${escapeHtml(date)}` : ''}</span>
          </div>
          ${safeLink ? `
            <a class="note-link" href="${safeLink}" target="_blank" rel="noopener">
              <span>Open full note</span><span>â†—</span>
            </a>` : ``}
        </article>
      `;
    }

    function escapeHtml(str) {
      return String(str || '')
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }

    // ===== Filters =====
    function setupFilters() {
      const pills = document.querySelectorAll('.filter-pill');
      pills.forEach(pill => {
        pill.addEventListener('click', () => {
          pills.forEach(p => p.classList.remove('active'));
          pill.classList.add('active');
          const filter = pill.getAttribute('data-filter') || 'all';
          applyFilter(filter);
        });
      });
    }

    function getCurrentFilter() {
      const active = document.querySelector('.filter-pill.active');
      return active ? (active.getAttribute('data-filter') || 'all') : 'all';
    }

    function applyFilter(filter) {
      const cards = document.querySelectorAll('.note-card');
      const emptyState = document.getElementById('emptyState');
      if (!cards.length) {
        if (emptyState) emptyState.style.display = 'block';
        return;
      }

      let visibleCount = 0;
      cards.forEach(card => {
        const cat = card.getAttribute('data-category') || 'field';
        const show = (filter === 'all') || (cat === filter);
        card.style.display = show ? 'flex' : 'none';
        if (show) visibleCount++;
      });

      if (emptyState) {
        emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
      }
    }
  </script>
</body>
</html>
