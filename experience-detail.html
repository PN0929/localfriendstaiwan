<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é«”é©—è©³æƒ… - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š</title>
  <meta name="description" content="Experience details - Local Friends Taiwan. Connect with real local hosts and communities across Taiwan.">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}

    :root{
      --header-height:56px;
      --max-width:1100px;
      --green:#2D6A4F;
      --bg:#F7F5F2;
      --accent:#F4845F;
      --accent-soft:#E9C46A;
    }

    html,body{overflow-x:hidden}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Microsoft JhengHei",sans-serif;
      line-height:1.7;
      color:var(--green);
      background:var(--bg);
      text-rendering:optimizeLegibility;
      -webkit-font-smoothing:antialiased;
      word-break:keep-all;
      overflow-wrap:anywhere;
    }
    h1,h2,h3{text-wrap:balance}
    img,video{max-width:100%;height:auto;display:block}

    /* ===== å…±ç”¨ Header ===== */
    .site-header{
      position:fixed;
      top:0;left:0;right:0;
      height:var(--header-height);
      padding:0 1.5rem;
      display:flex;
      align-items:center;
      gap:1.25rem;
      background:rgba(247,245,242,0.98);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(45,106,79,0.06);
      z-index:1100;
    }
    .brand{
      display:flex;
      flex-direction:column;
      justify-content:center;
      line-height:1.2;
    }
    .brand a{
      text-decoration:none;
      color:var(--green);
    }
    .brand-en{
      font-weight:700;
      letter-spacing:0.11em;
      font-size:0.78rem;
    }
    .brand-zh{
      opacity:0.9;
      font-size:0.78rem;
    }

    .main-nav{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:0.5rem;
    }
    .main-nav a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:0.4rem 0.9rem;
      border-radius:999px;
      border:1.4px solid transparent;
      font-size:0.86rem;
      font-weight:700;
      color:var(--green);
      text-decoration:none;
      white-space:nowrap;
      transition:all 0.18s;
    }
    .main-nav a span.en{margin-right:0.18rem;}
    .main-nav a:hover,
    .main-nav a.active{
      border-color:var(--accent-soft);
      background:#FFF7EB;
      box-shadow:0 2px 8px rgba(233,196,106,.25);
      transform:translateY(-1px);
    }

    .nav-toggle{
      display:none;
      margin-left:auto;
      width:34px;height:34px;
      border-radius:999px;
      border:1.4px solid var(--green);
      background:transparent;
      color:var(--green);
      font-size:1.2rem;
      cursor:pointer;
      align-items:center;
      justify-content:center;
      transition:all .2s;
    }
    .nav-toggle:hover{background:#E9C46A22;}
    .nav-toggle.open{
      background:var(--green);
      color:var(--bg);
      border-color:var(--green);
    }

    @media (max-width:768px){
      .site-header{padding:0 1rem;}
      .brand-en,.brand-zh{font-size:0.74rem;}

      .main-nav{
        position:fixed;
        top:var(--header-height);
        left:0;right:0;
        padding:0.45rem 0.85rem 0.55rem;
        background:rgba(247,245,242,0.98);
        backdrop-filter:blur(10px);
        border-bottom:1px solid rgba(45,106,79,0.08);
        display:none;
        flex-wrap:nowrap;
        gap:0.45rem;
        overflow-x:auto;
        white-space:nowrap;
        z-index:1090;
      }
      .main-nav.open{display:flex;}
      .main-nav::-webkit-scrollbar{height:3px;}
      .main-nav::-webkit-scrollbar-thumb{
        background:rgba(233,196,106,0.9);
        border-radius:999px;
      }
      .main-nav a{
        padding:0.35rem 0.8rem;
        font-size:0.8rem;
        box-shadow:0 1px 4px rgba(0,0,0,0.04);
      }
      .nav-toggle{display:inline-flex;}
    }

    /* å›é ‚æŒ‰éˆ• */
    .back-to-top{
      position:fixed;
      right:30px;bottom:30px;
      width:60px;height:60px;
      background:linear-gradient(135deg,#F4845F,#F4A261);
      color:#fff;border:none;border-radius:50%;
      font-size:1.5rem;cursor:pointer;
      box-shadow:0 4px 20px rgba(244,132,95,0.4);
      display:none;z-index:1000;
      transition:transform .3s;
    }
    .back-to-top:hover{transform:translateY(-5px);}
    .back-to-top.show{
      display:flex;align-items:center;justify-content:center;
      animation:fadeInUp .5s ease;
    }

    /* Hero for detail */
    .hero{
      position:relative;
      padding:calc(var(--header-height) + 2.2rem) 1.5rem 1.8rem;
      background:linear-gradient(
        135deg,
        rgba(45,106,79,0.98),
        rgba(64,145,108,0.96)
      );
      color:#fff;
      overflow:hidden;
    }
    .hero-inner{
      max-width:var(--max-width);
      margin:0 auto;
      display:grid;
      grid-template-columns:2.1fr 1.4fr;
      gap:1.4rem;
      align-items:stretch;
    }
    .hero-text h1{
      font-size:2.1rem;
      font-weight:800;
      margin-bottom:.2rem;
      line-height:1.25;
    }
    .hero-text .en-title{
      font-size:.9rem;
      opacity:.96;
      margin-bottom:.35rem;
      font-weight:600;
    }
    .hero-text .one-line{
      font-size:.95rem;
      opacity:.95;
      line-height:1.7;
    }
    .hero-tags{
      margin-top:.6rem;
      display:flex;
      flex-wrap:wrap;
      gap:.35rem;
      font-size:.75rem;
    }
    .hero-tag{
      padding:.18rem .6rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.6);
      background:rgba(0,0,0,0.16);
      display:inline-flex;
      align-items:center;
      gap:.18rem;
    }

    .hero-media{
      position:relative;
      border-radius:14px;
      overflow:hidden;
      background:#234;
      box-shadow:0 6px 22px rgba(0,0,0,0.22);
    }
    .hero-media-main{
      position:absolute;
      inset:0;
      object-fit:cover;
      width:100%;
      height:100%;
    }
    .hero-media-fallback{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-size:.9rem;
      opacity:.7;
    }

    @media (max-width:768px){
      .hero{
        padding:calc(var(--header-height) + 1.6rem) 1rem 1.4rem;
      }
      .hero-inner{
        grid-template-columns:1fr;
        gap:0.9rem;
      }
      .hero-text h1{
        font-size:1.6rem;
      }
      .hero-text .en-title{
        font-size:.82rem;
      }
      .hero-text .one-line{
        font-size:.86rem;
      }
      .hero-tags{
        font-size:.7rem;
      }
      .hero-media{
        height:180px;
      }
    }

    /* Main layout */
    .page{
      max-width:var(--max-width);
      margin:0 auto;
      padding:1.4rem 1.5rem 3rem;
    }
    @media (max-width:768px){
      .page{padding:1.2rem 1rem 2.4rem;}
      .back-to-top{
        right:16px;bottom:16px;
        width:48px;height:48px;font-size:1.2rem;
      }
    }

    .section{
      background:#fff;
      border-radius:14px;
      border:1.8px solid #E5DECF;
      box-shadow:0 4px 16px rgba(0,0,0,0.04);
      padding:1.8rem 1.6rem;
      margin-bottom:1.4rem;
    }
    .section h2{
      font-size:1.4rem;
      font-weight:800;
      color:var(--green);
      margin-bottom:.9rem;
      border-bottom:2px solid var(--accent-soft);
      padding-bottom:.4rem;
    }

    /* Doc render */
    .doc-render-inner{
      max-width:100%;
      font-size:.97rem;
      color:#333;
      line-height:1.85;
    }
    .doc-render-inner h1,
    .doc-render-inner h2,
    .doc-render-inner h3,
    .doc-render-inner h4{
      margin:1.2rem 0 .5rem;
      font-size:1.02rem;
      font-weight:700;
      color:#234;
    }
    .doc-render-inner p{
      margin:.35rem 0;
    }
    .doc-render-inner ul,
    .doc-render-inner ol{
      margin:.4rem 0 .4rem 1.1rem;
    }
    .doc-render-inner li{margin:.18rem 0;}

    .doc-render-inner img{
      max-width:100% !important;
      height:auto !important;
      display:block;
      margin:.6rem auto;
      border-radius:8px;
      box-shadow:0 2px 10px rgba(0,0,0,0.06);
    }
    .doc-render-inner figure{
      max-width:100%;
      margin:.6rem 0;
    }

    .doc-render-inner table{
      border-collapse:collapse;
      width:100%;
      margin:.6rem 0;
    }
    .doc-render-inner th,
    .doc-render-inner td{
      border:1px solid #e6e6e6;
      padding:.4rem .55rem;
      font-size:.9rem;
      vertical-align:top;
    }
    .doc-render-inner thead th{
      background:#f7f7f7;
      font-weight:700;
    }

    /* è¡¨æ ¼å¤–å±¤åŠ ä¸€å±¤å¯æ©«å‘æ²å‹•çš„å®¹å™¨ */
    .doc-table-wrap{
      width:100%;
      overflow-x:auto;
      margin:.6rem 0;
    }
    .doc-table-wrap::-webkit-scrollbar{height:4px;}
    .doc-table-wrap::-webkit-scrollbar-thumb{
      background:rgba(233,196,106,0.9);
      border-radius:999px;
    }

    .loading-line{
      height:9px;
      border-radius:5px;
      background:linear-gradient(90deg,#e9f3ee,#f3faf7,#e9f3ee);
      background-size:200% 100%;
      animation:shimmer 1.1s infinite;
      margin:.3rem 0;
    }
    @keyframes shimmer{
      0%{background-position:0 0}
      100%{background-position:200% 0}
    }

    /* Contact info */
    .info-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:1rem;
      margin-top:.4rem;
    }
    .info-item{
      background:#F7F5F2;
      border-radius:10px;
      padding:.9rem .9rem;
      border:1px solid #E9C46A;
      font-size:.9rem;
      color:#333;
    }
    .info-item h3{
      font-size:.9rem;
      font-weight:800;
      color:var(--green);
      margin-bottom:.25rem;
    }
    .info-item a{
      color:var(--accent);
      text-decoration:none;
      word-break:break-all;
      font-weight:600;
    }
    .info-item a:hover{text-decoration:underline;}

    /* Map */
    .map-address{
      font-size:.9rem;
      color:#555;
      padding:.6rem .7rem;
      background:#F7F5F2;
      border-radius:7px;
      border-left:3px solid var(--accent-soft);
      margin-bottom:.7rem;
    }
    .map-container{
      width:100%;
      height:360px;
      border-radius:10px;
      overflow:hidden;
      box-shadow:0 4px 16px rgba(0,0,0,0.06);
    }
    .map-container iframe{
      width:100%;
      height:100%;
      border:0;
    }
    @media (max-width:768px){
      .map-container{height:260px;}
    }

    /* CTA */
    .cta-section{
      background:linear-gradient(135deg,#2D6A4F,#40916C);
      color:#fff;
      padding:2.2rem 1.6rem;
      border-radius:14px;
      box-shadow:0 4px 18px rgba(0,0,0,0.16);
      text-align:center;
    }
    .cta-section h2{
      font-size:1.5rem;
      margin-bottom:.4rem;
      font-weight:800;
    }
    .cta-section p{
      font-size:.98rem;
      margin-bottom:1.2rem;
      opacity:.96;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.8rem 1.6rem;
      border-radius:999px;
      background:linear-gradient(135deg,#F4845F,#F4A261);
      color:#fff;
      text-decoration:none;
      font-weight:800;
      font-size:.92rem;
      box-shadow:0 4px 14px rgba(244,132,95,0.45);
      transition:all .22s;
    }
    .btn:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 20px rgba(244,132,95,0.65);
    }

    .footer{
      background:linear-gradient(135deg,#2D6A4F,#40916C);
      color:#fff;
      text-align:center;
      padding:2.4rem 2rem;
    }
    .footer a{
      color:#fff;
      text-decoration:none;
      font-weight:700;
    }
    .footer a:hover{text-decoration:underline;}

    @keyframes fadeInUp{
      from{opacity:0;transform:translateY(18px);}
      to{opacity:1;transform:translateY(0);}
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="brand">
      <a href="index.html">
        <div class="brand-en">LOCAL FRIENDS TAIWAN</div>
        <div class="brand-zh">å°ç£åœ¨åœ°é€£ç·š</div>
      </a>
    </div>
    <nav class="main-nav" id="mainNav">
      <a href="experiences.html" class="active"><span class="en">Experiences</span><span class="zh">é«”é©—åˆ—è¡¨</span></a>
      <a href="about.html"><span class="en">About</span><span class="zh">é—œæ–¼æˆ‘å€‘</span></a>
      <a href="faq.html"><span class="en">FAQ</span><span class="zh">å¸¸è¦‹å•é¡Œ</span></a>
      <a href="hosts.html"><span class="en">For Hosts</span><span class="zh">æˆç‚ºåœ¨åœ°æœ‹å‹</span></a>
      <a href="notes.html"><span class="en">Trail Notes</span><span class="zh">æ¢è·¯ç­†è¨˜</span></a>
      <a href="contact.html"><span class="en">Contact</span><span class="zh">è¯ç¹«æˆ‘å€‘</span></a>
    </nav>
    <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">â˜°</button>
  </header>

  <!-- Back to top -->
  <button class="back-to-top" onclick="scrollToTop()">â†‘</button>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-text">
        <h1 id="expTitleZh">è¼‰å…¥ä¸­ Loading...</h1>
        <div class="en-title" id="expTitleEn"></div>
        <div class="one-line" id="expOneLine"></div>
        <div class="hero-tags" id="heroTags"></div>
      </div>
      <div class="hero-media">
        <img id="heroImage" class="hero-media-main" alt="experience cover" style="display:none;">
        <div class="hero-media-fallback" id="heroFallback">Local Friends Taiwan Â· Experience</div>
      </div>
    </div>
  </section>

  <!-- Main content -->
  <main class="page">
    <!-- è©³ç´°èªªæ˜ -->
    <section class="section" id="detailSection">
      <h2>ğŸ“– Details è©³ç´°èªªæ˜</h2>
      <div class="doc-render-inner" id="docRenderInner">
        <div class="loading-line" style="width:65%"></div>
        <div class="loading-line" style="width:80%"></div>
        <div class="loading-line" style="width:50%"></div>
      </div>
    </section>

    <!-- è¯çµ¡è³‡è¨Š -->
    <section class="section" id="contactSection" style="display:none;">
      <h2>ğŸ“ Contact è¯çµ¡è³‡è¨Š</h2>
      <div class="info-grid" id="contactGrid"></div>
    </section>

    <!-- åœ°åœ– -->
    <section class="section" id="mapSection" style="display:none;">
      <h2>ğŸ“ Location ä½ç½®è³‡è¨Š</h2>
      <div class="map-address" id="mapAddress"></div>
      <div class="map-container">
        <iframe id="mapFrame" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </section>

    <!-- CTA -->
    <section class="cta-section">
      <h2>Ready to Start Your Experience?</h2>
      <p>ç›´æ¥è¯ç¹«ä¸»è¾¦å–®ä½ï¼Œå®‰æ’åªå±¬æ–¼ä½ çš„åœ¨åœ°é«”é©—ã€‚<br>Contact the organizer to arrange your unique local experience.</p>
      <a href="experiences.html" class="btn">â† Back to Experiences è¿”å›é«”é©—åˆ—è¡¨</a>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p style="font-size:1.2rem;margin-bottom:0.6rem;"><strong>Local Friends Taiwan å°ç£åœ¨åœ°é€£ç·š</strong></p>
    <p>Your local friend in Taiwan | ç•¶ä½ éœ€è¦ä¸€ä½å°ç£åœ¨åœ°çš„æœ‹å‹</p>
    <p style="margin-top:1.2rem;opacity:0.9;font-size:0.95rem;">
      Â© 2025 Local Friends Taiwan. Independent Information Platform.
    </p>
  </footer>

  <script>
    const SHEET_ID  = '1GD4gg3sGIfX7KGrJkYCL10wzvwZh5FMWQPGd9NVTQyc';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
    const FALLBACK_DOC_URL = 'https://docs.google.com/document/d/e/2PACX-1vQj1gYlRDbgpH-IupwfkeS8kSMIvGb9TadFFwGpzj9TJXLYv3kzvhu9BqcpUetG-y7Dpt2M8qJLFkoV/pub';

    // Mobile nav toggle
    document.addEventListener('DOMContentLoaded', () => {
      const navToggle = document.getElementById('navToggle');
      const mainNav = document.getElementById('mainNav');
      if(navToggle && mainNav){
        navToggle.addEventListener('click', () => {
          const isOpen = mainNav.classList.toggle('open');
          navToggle.classList.toggle('open', isOpen);
        });
        mainNav.querySelectorAll('a').forEach(a=>{
          a.addEventListener('click', () => {
            if(mainNav.classList.contains('open')){
              mainNav.classList.remove('open');
              navToggle.classList.remove('open');
            }
          });
        });
      }

      loadExperience();
    });

    // Back to top
    window.addEventListener('scroll', () => {
      const b = document.querySelector('.back-to-top');
      if (!b) return;
      if (window.pageYOffset > 300) b.classList.add('show');
      else b.classList.remove('show');
    });
    function scrollToTop(){
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function loadExperience(){
      const params = new URLSearchParams(window.location.search);
      const id = (params.get('id') || '').trim();
      if(!id){
        document.getElementById('expTitleZh').textContent = 'æ‰¾ä¸åˆ°é«”é©— ID / Experience ID not found';
        document.getElementById('docRenderInner').innerHTML =
          '<p>è«‹å¾é«”é©—åˆ—è¡¨é‡æ–°é¸æ“‡ä¸€å€‹é«”é©—ã€‚<br>Please go back to the experiences list.</p>';
        return;
      }

      try{
        const resp = await fetch(SHEET_URL);
        const txt = await resp.text();
        const rows = parseCSV(txt);
        const headers = rows[0];
        const data = rows.slice(1);

        const exp = data.map(r=>{
          const o={}; headers.forEach((h,i)=>o[h]=r[i]||''); return o;
        }).find(o=>(o['ID']||'').trim().toLowerCase()===id.toLowerCase());

        if(!exp){
          document.getElementById('expTitleZh').textContent = 'æ‰¾ä¸åˆ°æ­¤é«”é©— / Experience not found';
          document.getElementById('docRenderInner').innerHTML =
            '<p>æ­¤é€£çµå¯èƒ½å·²å¤±æ•ˆï¼Œè«‹å›åˆ°é«”é©—åˆ—è¡¨ã€‚<br>This experience may be unpublished. Please return to the list.</p>';
          return;
        }

        renderHero(exp);
        renderDetailFromDoc(exp);
        renderContact(exp);
        renderMap(exp);

        document.title = (exp['é«”é©—åç¨±(ä¸­)'] || 'é«”é©—è©³æƒ…') + ' - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š';
      }catch(err){
        console.error(err);
        document.getElementById('expTitleZh').textContent = 'è¼‰å…¥ç™¼ç”ŸéŒ¯èª¤ / Error loading data';
        document.getElementById('docRenderInner').innerHTML =
          '<p>æš«æ™‚ç„¡æ³•è¼‰å…¥é«”é©—å…§å®¹ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚<br>Unable to load experience details.</p>';
      }
    }

    function parseCSV(csv){
      const lines = csv.split('\n');
      return lines.map(line=>{
        const values=[]; let cur=''; let inQ=false;
        for(const ch of line){
          if(ch==='"') inQ=!inQ;
          else if(ch===',' && !inQ){
            values.push(cur.trim());
            cur='';
          }else{
            cur+=ch;
          }
        }
        values.push(cur.trim());
        return values;
      });
    }

    function getPhotoLinks(exp){
      const raw = (exp['ç…§ç‰‡é›†'] || exp['å°é¢åœ–é€£çµ'] || exp['åœ–ç‰‡'] || '').replace(/ï¼Œ/g, ',');
      return raw.split(/[,\s]+/).map(s=>s.trim()).filter(Boolean);
    }

    function renderHero(exp){
      const nameZh = (exp['é«”é©—åç¨±(ä¸­)'] || '').trim();
      const nameEn = (exp['é«”é©—åç¨±(è‹±)'] || '').trim();
      const oneLine = (exp['ä¸€å¥è©±æè¿°(ä¸­)'] || exp['ä¸€å¥è©±æè¿°(è‹±)'] || '').trim();
      const region = (exp['åœ°å€'] || '').trim();
      const cat = (exp['ä¸»è¦åˆ†é¡'] || '').trim();
      const level = (exp['é›£åº¦'] || '').trim();

      document.getElementById('expTitleZh').textContent = nameZh || 'æœªå‘½åé«”é©— Untitled Experience';
      document.getElementById('expTitleEn').textContent = nameEn || '';
      document.getElementById('expOneLine').textContent = oneLine || '';

      const tagsEl = document.getElementById('heroTags');
      tagsEl.innerHTML = '';
      if(region) tagsEl.innerHTML += `<div class="hero-tag">ğŸ“ ${region}</div>`;
      if(cat) tagsEl.innerHTML += `<div class="hero-tag">${cat}</div>`;
      if(level) tagsEl.innerHTML += `<div class="hero-tag">â­ ${level}</div>`;

      const links = getPhotoLinks(exp);
      const heroImg = document.getElementById('heroImage');
      const fallback = document.getElementById('heroFallback');
      if(links.length){
        heroImg.src = links[0];
        heroImg.style.display = 'block';
        heroImg.onerror = () => {
          heroImg.style.display='none';
          fallback.style.display='flex';
        };
        fallback.style.display='none';
      }else{
        heroImg.style.display='none';
        fallback.style.display='flex';
      }
    }

    async function renderDetailFromDoc(exp){
      const inner = document.getElementById('docRenderInner');
      inner.innerHTML = `
        <div class="loading-line" style="width:65%"></div>
        <div class="loading-line" style="width:80%"></div>
        <div class="loading-line" style="width:50%"></div>
      `;

      const raw = (exp['è©³ç´°èªªæ˜é€£çµ'] || exp['Google Doc'] || exp['Google Doc é€£çµ'] || '').trim();
      const url = raw || FALLBACK_DOC_URL;
      const fetchURL = toFetchableDocURL(url);

      try{
        const resp = await fetch(fetchURL,{mode:'cors'});
        const html = await resp.text();

        const tmp = document.createElement('div');
        tmp.innerHTML = html;

        let main = tmp.querySelector('#contents') || tmp.querySelector('body') || tmp;
        if(!main) main = tmp;

        // ç§»é™¤ä¸éœ€è¦çš„å…¨åŸŸæ¨£å¼ / scripts
        main.querySelectorAll('script,style,header,nav,footer,link').forEach(n=>n.remove());

        const wrapper = document.createElement('div');
        wrapper.innerHTML = main.innerHTML;

        // è™•ç†åœ–ç‰‡
        wrapper.querySelectorAll('img').forEach(img=>{
          img.removeAttribute('width');
          img.removeAttribute('height');
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          img.loading = 'lazy';
          img.style.display = 'block';
          img.style.margin = '.6rem auto';
          img.style.borderRadius = '8px';
          img.style.boxShadow = '0 2px 10px rgba(0,0,0,0.06)';
          img.onerror = () => {
            img.replaceWith(Object.assign(document.createElement('div'), {
              textContent: 'ğŸ“· åœ–ç‰‡ç„¡æ³•è¼‰å…¥',
              style: 'text-align:center;color:#888;padding:0.6rem 0;font-size:0.85rem;'
            }));
          };
        });

        // è¡¨æ ¼å¤–åŒ…å±¤ï¼Œå•Ÿç”¨æ°´å¹³æ²å‹•
        wrapper.querySelectorAll('table').forEach(table=>{
          const wrap = document.createElement('div');
          wrap.className = 'doc-table-wrap';
          table.parentNode.insertBefore(wrap, table);
          wrap.appendChild(table);
        });

        // å…§åµŒ iframeã€embed å¯¬åº¦ä¿®æ­£
        wrapper.querySelectorAll('iframe,embed').forEach(el=>{
          el.removeAttribute('width');
          el.style.width = '100%';
          el.style.maxWidth = '100%';
        });

        inner.innerHTML = '';
        inner.appendChild(wrapper);
      }catch(err){
        console.warn('Doc fetch blocked, fallback iframe', err);
        inner.innerHTML = `
          <iframe src="${toEmbeddableIframeURL(url)}"
                  style="width:100%;height:900px;border:0;border-radius:10px;background:#fff"
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"></iframe>
        `;
      }
    }

    function toFetchableDocURL(url){
      if(/\/document\/d\/e\/[^/]+\/pub/.test(url)){
        return url.includes('?') ? url : url + '?embedded=true';
      }
      const m = url.match(/\/document\/d\/([^/]+)/);
      if(m){
        const id = m[1];
        return `https://docs.google.com/document/d/${id}/export?format=html`;
      }
      return url;
    }
    function toEmbeddableIframeURL(url){
      if(/\/document\/d\/e\/[^/]+\/pub/.test(url)){
        return url.includes('?') ? url+'&embedded=true' : url+'?embedded=true';
      }
      const m = url.match(/\/document\/d\/([^/]+)/);
      if(m){
        const id = m[1];
        return `https://docs.google.com/document/d/${id}/preview?rm=minimal&embedded=true`;
      }
      return url;
    }

    function renderContact(exp){
      const box = document.getElementById('contactSection');
      const grid = document.getElementById('contactGrid');
      let has = false;

      function add(label, value, isLink, prefix){
        if(!value) return;
        has = true;
        const item = document.createElement('div');
        item.className = 'info-item';
        item.innerHTML = `<h3>${label}</h3>`;
        if(isLink){
          item.innerHTML += `<a href="${prefix || ''}${value}">${value}</a>`;
        }else{
          item.innerHTML += `<div>${value}</div>`;
        }
        grid.appendChild(item);
      }

      add('Organizer ä¸»è¾¦å–®ä½', (exp['ä¸»è¾¦å–®ä½']||'').trim());
      add('Contact Person è¯çµ¡äºº', (exp['è¯çµ¡äºº']||'').trim());
      add('Phone é›»è©±', (exp['é›»è©±']||'').trim(), true, 'tel:');
      add('Email', (exp['Email']||'').trim(), true, 'mailto:');
      add('Website ç¶²ç«™', (exp['ç¶²ç«™']||'').trim(), true, '');
      add('Social Media ç¤¾ç¾¤', (exp['ç¤¾ç¾¤åª’é«”']||'').trim(), true, '');

      if(has){ box.style.display='block'; }
    }

    function renderMap(exp){
      const addr = (exp['åœ°å€']||'').trim();
      if(!addr) return;
      const mapSection = document.getElementById('mapSection');
      const addrEl = document.getElementById('mapAddress');
      const frame = document.getElementById('mapFrame');

      addrEl.textContent = 'ğŸ“ ' + addr;
      frame.src = `https://www.google.com/maps?q=${encodeURIComponent(addr)}&output=embed`;
      mapSection.style.display = 'block';
    }
  </script>
</body>
</html>
